### 类加载

类从被加载到虚拟机内存中开始，到卸载出内存为止，它的整个生命周期包括：加载（Loading）、验证（Verification）、准备（Preparation）、解析（Resolution）、初始化（Initialization），这 5个阶段一般是顺序发生的，但在动态绑定的情况下，解析阶段发生在初始化阶段之后。

#### 如果类没有进行过初始化，以下行为能触发其初始化。

- new关键字实例化对象
- 读取或设置一个类的静态字段（非final字段）
- 调用一个类的静态方法
- java.lang.reflect包的方法对类进行反射调用
- 初始化子类时，必先初始化其父类
- 虚拟机先初始化Main方法所在类

#### 类加载的过程

1. 加载（Loading）
   - 将字节码从不同的数据源（可能是 class 文件、jar 包、网络、运行时计算生成（动态代理）等）转化为二进制字节流加载到内存中
   - 将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构
   - 在内存中生成一个代表这个类的java.lang.Class对象，作为方法区这个类的各种数据

2. 验证（Verification）
   JVM 会在该阶段对二进制字节流进行校验，只有符合 JVM 字节码规范的才能被 JVM 正确执行。该阶段是保证 JVM 安全的重要屏障，下面是一些主要的检查。
   - 确保二进制字节流格式符合预期（比如说是否以 `cafe bene` 开头）。
   - 是否所有方法都遵守访问控制关键字的限定。
   - 方法调用的参数个数和类型是否正确。
   - 确保变量在使用之前被正确初始化了。
   - 检查变量是否被赋予恰当类型的值。

3. 准备（Preparation）
   JVM 会在该阶段对类变量（也称为静态变量，`static` 关键字修饰的）分配内存并初始化（对应数据类型的默认初始值，如 0、0L、null、false 等）。

   | 数据类型  | 默认初始值 |
   | :-------: | :--------: |
   |    int    |     0      |
   |   long    |     0L     |
   |  boolean  |   false    |
   |   float   |    0.0f    |
   |   short   | （short）0 |
   |  double   |    0.0d    |
   |   char    |   u0000    |
   | reference |    null    |
   |   byte    | （byte）0  |

4. 解析（Resolution）
   该阶段将常量池中的符号引用转化为直接引用。
   **符号引用**以一组符号（任何形式的字面量，只要在使用时能够无歧义的定位到目标即可）来描述所引用的目标。

   **直接引用**通过对符号引用进行解析，找到引用的实际内存地址。

5. 初始化（Initialization）

   该阶段是类加载过程的最后一步。在准备阶段，类变量已经被赋过默认初始值，而在初始化阶段，类变量将被赋值为代码期望赋的值。换句话说，初始化阶段是执行**类构造器方法**的过程。

#### 类加载器























   

   

   

   

   

   

   

   

   

   