# 动态代理

## 1、反射

反射最大的作用之一就在于我们可以不在编译时知道某个对象的类型，而在运行时通过提供完整的”包名+类名.class”得到。注意：不是在编译时，而是在运行时。

### 1.1、功能：

利用Java反射机制我们可以加载一个运行时才得知名称的class，获悉其构造方法，并生成其对象实体，能对其属性设值并调用其方法。

### 1.2、缺点：

    反射会额外消耗一定的系统资源（慢），同时可能破坏类的封装性（不安全）。

## 2、什么是动态代理

参考设计模式中代理模式，动态代理就是代理类不是由我们手动编码，而是由其他手段生成的。

### 2.2实现动态代理的手段

-   Proxy （java动态代理）
-   cglib 

### 2.2Proxy与cglib区别

Proxy动态代理是利用反射机制生成一个实现代理接口的匿名类，在调用具体方法前调用InvokeHandler来处理。
cglib动态代理是利用asm开源包，对代理对象类的class文件加载进来，通过修改其字节码生成子类来处理。

-   Proxy只能对实现了接口的类生成代理，而不能针对类
-   CGLIB是针对类实现代理，主要是对指定的类生成一个子类，覆盖其中的方法
因为是继承，所以该类或方法最好不要声明成final 
Spring AOP会自动在Proxy 和CGLIB 切换， 一般都是 目标对象有接口 默认用Proxy ，但可以强制使用CGLIB ，如果没有接口强制用CGLIB
更推荐用Java动态代理，原因只有一个JDK 本身支持，升级平滑，代码阅读性、可维护性高。